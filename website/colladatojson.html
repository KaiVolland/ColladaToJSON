<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta http-equiv="X-UA-Compatible" content="chrome=1"/>
<title>OpenWebGlobe SDK: Collada to JSON Converter</title>


<script type="text/javascript">

    var reader = null;
    function readFile(file, callback)
    {
        reader = new FileReader();
        reader.onload = function(evt)
        {
            //document.getElementById('status').innerHTML = "Ready";
            if (typeof callback=="function")
                callback(file, evt);
        };
        reader.onprogress = updateProgress;
        reader.onerror = errorHandler;
        reader.readAsBinaryString( file );

    }


    function updateProgress(evt)
    {
       console.log("Processing");
    }

    function errorHandler(evt)
    {
        console.log("Error ("+evt.target.error.code+")");
    }


    function main()
    {

        
        
    }

    function fileReadSuccess()
    {
        url = "http://localhost:8000/";
        http_request = new window.XMLHttpRequest();
        http_request.open("POST",url, true);
        http_request.onreadystatechange =  cbfConversion;
        http_request.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        http_request.setRequestHeader("Content-length", reader.result.length);
        http_request.setRequestHeader("Connection", "close");
        // http_request.setRequestHeader("Cache-Control", "public");
        http_request.send("colladastring="+reader.result+
                            "&lng="+lng+"&lat="+lat+"&elv="+elv+
                            "&filename="+filename+"&pretty=false");

    }



    var lng;
    var lat;
    var elv;
    var filename;

    function conversionStart()
    {
        //Check input fields
        lng = document.getElementById("input_lng").value;
        lat = document.getElementById("input_lat").value;
        elv = document.getElementById("input_elv").value;
        filename = document.getElementById("input_file").value;


        console.log(lng);
        console.log(lat);
        console.log(elv);



        // if all inputs are correct start upload
        var input = document.getElementById("input_file");

        if ( typeof FileReader=="undefined" || !input.files)
        {
            alert("Your browser doesn't support the HTML 5 File API!");
            return;
        }
        if ( input.files.length < 1 )
        {
            alert("Please select a file!");
            return;
        }
        readFile(input.files[0],fileReadSuccess);
    }

    var jsonfile = null;
    function cbfConversion()
    {
        if (http_request.readyState == 4 && http_request.status == 200)
        {
            jsonfilename = http_request.responseText;

            //Error handling:
            if(jsonfilename.substr(0,5).toLowerCase()=="error")
                alert(jsonfilename);
            else
                window.open('../scripts/'+jsonfilename);



        }

    }
//----------------------------------------------------------------------------------------------------------------------


</script>

</head>
<body onload="main()">

    <div id="divMainTitle"><h1>The OpenWebGlobe Collada to JSON Converter</h1></div>
    <div id="divMainEntry">
        <form enctype="multipart/form-data"><!--action="input_file.htm" method="post" -->
            <p>Select a Collada (*.dae) file or drag a file into this panel.<br>
                <input id="input_file" name="File" type="file" size="50" maxlength="100000" accept="text/*">
            <p>Center</p>
                <table>
                    <td>
                        <tr>
                            Longitude: <input id="input_lng" type="text">
                        </tr>
                    </td>
                    <td>
                        <tr>
                            Latitude: <input id="input_lat" type="text">
                        </tr>
                    </td>
                    <td>
                        <tr>
                            Elevation: <input  id="input_elv" type="text">
                        </tr>
                    </td>
                </table>
            <input type="button" value="Convert" onclick="conversionStart()">
        </form>
    </div>

    <div id="divPreview"></div>

</body>

